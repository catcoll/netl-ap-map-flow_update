      MODULE TWOD_MODULE
C     WRITTEN BY: MATTHEW STADELMAN
C     PROGRAM DESCRIPTION: STORES THE NEEDED VARIABLES AND CONSTANTS FOR 
C     2-D LOCAL CUBIC LAW MODEL.
C     LAST MODIFIED: 12/21/2015
C ----------------------------------------------------------------------
C               ---- VARIABLE DESCRIPTIONS ----
C   INTERPOLATION VARIABLES: 
C     PR, ZF, VI - VECTORS OF PRESSURE, Z FACTOR AND VISCOSITY 
C     PS, SQPS - VECTORS OF THE PSEUDO-PRESSURE AND ITS SQUAREROOT
C     EQSPS - VECTOR CONTAINING EQUALLY SPACED SQRT OF PHI 
C     EQPR - VECTORS CONTAINING PRESSURES CORRESPONDING TO EQSPS
C     DPR,DSPS - CHANGE IN PRESSURE AND CHANGE IN SQRT OF PSEUDO-PRESSURE
C     NVALS - NUMBER OF ENTRIES IN THE PVT DATA TABLE
C     VALS - 101 VALUES FROM 0 TO THE MAXIMUM VALUE IN PVT TABLE
C
C   STATISTICS VARIABLES:
C     STD_PRES, STD_TEMP - STANDARD VALUES FOR TEMPERATURE AND PRESSURE
C     TEMP - FRACTURE TEMPERATURE 
C
C   FRACTURE VARIABLES:
C     OUTRATE - OUTLET FLOW RATE BOUNDARY CONDITION
C     OUTPB, OUTPSB - OUTLET PRESSURE AND PSEUDO-PRESSURE
C     FPB,FPSB - FRACTURE PRESSURE AND PSEUDO-PERSSURE
C     APER - APERTURE OF FRACTURE
C 
C   COMMON VARIABLES:
C     DIAM, LENG - PHYSICAL SIZE OF FRACTURE 
C     TRX,TRZ - TRANSMISSABLITY VECTORS IN THE X AND Z DIRECTIONS
C     DX - DELTA X, DZ - DELTA Z
C     NX - NUMBER OF GRID BLOCKS IN X
C     NZ - NUMBER OF GRID BLOCKS IN Z
C
C ---------------------------------------------------------------------  
C
      PUBLIC
C
C     INTERPOLATION/PVT VARIABLES 
      REAL(8),ALLOCATABLE,SAVE :: PR(:),ZF(:),VI(:),PS(:)   
      REAL(8),ALLOCATABLE,SAVE :: SQPS(:),EQSPS(:),EQPR(:) 
      REAL(8),SAVE :: DPR,DSPS
      REAL(8),SAVE :: TEMP,STD_TEMP,STD_PRES
      REAL(8),SAVE :: PRES_CONV,DIM_CONV,TIME_CONV,RATE_CONV
      REAL(8),SAVE :: VISC_CONV,RHO_CONV,TEMP_CONV,STD_CONV
      INTEGER, SAVE :: NVALS,VALS
C
C     UNIT CONVERSION PARAMETERS
      !TIME TO SECONDS 
      REAL(8) :: DAY_SEC, HR_SEC, MIN_SEC
      PARAMETER (DAY_SEC = 86400.0, HR_SEC = 3600.0, MIN_SEC = 60.0)
      !DISTANCE TO METERS  !VOX SIZE IS DIFFERENT FOR EVERY SCAN
      REAL(8) :: MIC_MET,MM_MET,CM_MET,IN_MET,FT_MET,VOX_MET
      PARAMETER (MIC_MET = 1E-6, MM_MET = 1E-3, CM_MET = 0.01)
      PARAMETER (IN_MET = 0.0254, FT_MET = 0.3048)
      !MASS TO KILOGRAMS
      REAL(8) :: GM_KG,LBS_KG,SLG_KG
      PARAMETER (GM_KG = 0.001, LBS_KG = 0.4535924, SLG_KG = 14.59390)
      !PRESSURE TO PA                
      REAL(8) :: ATM_PA, BAR_PA, KPA_PA, PSI_PA
      PARAMETER (ATM_PA = 101325.0, BAR_PA = 100000.0)
      PARAMETER (KPA_PA = 1000.0, PSI_PA = 6894.757293178)
      !TEMP TO RANKINE
      REAL(8) :: FAR_RAN
      PARAMETER (FAR_RAN = 459.67)
      !VISCOSITY TO PA*S
      REAL(8) :: CP_PASEC
      PARAMETER (CP_PASEC = 0.001)
      ! GRAVITY
      REAL(8) :: STD_G
      PARAMETER (STD_G = 9.80665)
C
C     STATISTICS VARIABLES
      REAL(8),ALLOCATABLE,SAVE :: PERC_ARR(:,:)
      REAL(8),SAVE :: MIN_APER,MAX_APER,APER_RMS,APER_DEV,X_CORR,Z_CORR
      INTEGER,SAVE :: NPCT
      LOGICAL,SAVE :: PERCENTILE
C
C     FRACTURE VARAIBLES 
      REAL(8),ALLOCATABLE,SAVE :: AP_MAP(:,:,:),WIDTH(:),DX(:),DZ(:)
      REAL(8),ALLOCATABLE,SAVE :: FRAC_PR(:,:),FRAC_PS(:,:)
      REAL(8),ALLOCATABLE,SAVE :: TRX(:,:),TRZ(:,:)
      REAL(8),SAVE :: DIAM,LENG,HOM_APER,HOM_TRX,HOM_TRZ,HOM_VISC
      REAL(8),SAVE :: OUTPB,OUTPSB,OUTRATE,FPB,FPSB,RHO
      REAL(8),SAVE :: R_FACT,AVG_FACT,HIGH_MASK,LOW_MASK
      INTEGER,ALLOCATABLE,SAVE :: PBCELLS(:)
      INTEGER,SAVE :: IFLUID,NX,NZ,NC
      LOGICAL,SAVE :: MANIFOLD,RATEC,PRESC
C
C     OTHER PARAMETERS
      INTEGER :: MAXFLD,MAXLEN,MAXDIM
      PARAMETER (MAXFLD = 100000,MAXLEN = 256,MAXDIM = 10000)
C
C     IO VARIABLES
      INTEGER,SAVE :: IINP,IPVT,IAPM !INPUT IO
      INTEGER,SAVE :: IOUT,ISTAT,IPRES,IFLOX,IFLOZ,IFLOM !OUTPUT IO
      INTEGER,SAVE :: IMAP,IVTK !OUTPUT IO
      CHARACTER(MAXLEN),SAVE :: MASTER,APM_FILE,PVT_FILE
      CHARACTER(MAXLEN),SAVE :: SUM_FILE,STAT_FILE,FLOW_FILE,PRESS_FILE
      CHARACTER(MAXLEN),SAVE :: MAP_FILE,VTK_FILE
      CHARACTER(MAXLEN),SAVE :: CVAR,UNIT(7),UNIT_IN(7),UNIT_OUT(7)
      !
      INTEGER,SAVE :: LFLD(MAXFLD)
      CHARACTER(MAXLEN),SAVE :: CFLD(MAXFLD)
      CHARACTER(MAXLEN),SAVE :: OUTFLOW
C
C     OPENFOAM EXPORT VARIABLES
      REAL(8),SAVE,ALLOCATABLE :: VERTICIES(:,:)
      INTEGER,SAVE,ALLOCATABLE :: BLOCKS(:,:),INLET(:,:),OUTLET(:,:)
      INTEGER,SAVE,ALLOCATABLE :: FRONTBACK(:,:),SIDES(:,:)
      INTEGER,SAVE :: INTERNAL_MESH(3)
      INTEGER :: IBMD
      CHARACTER(MAXLEN),SAVE :: FOAM_FILE
      LOGICAL,SAVE :: FOAM_EXPORT

      
C      
C
      CONTAINS  
C
C     SETS UP VECTORS FOR THE FRACTURE PROPERTIES 
      SUBROUTINE ALLOCATE_FRAC(NX,NZ)
C
        IMPLICIT NONE
        INTEGER :: NX, NZ
C
        ALLOCATE(WIDTH(NX*NZ))
        ALLOCATE(TRX(1:NZ,0:NX),TRZ(0:NZ,1:NX))
        ALLOCATE(FRAC_PR(0:NZ+1,0:NX+1),FRAC_PS(0:NZ+1,0:NX+1))
        ALLOCATE(DX(NX*NZ),DZ(NX*NZ),PBCELLS(MAX(NX,NZ)))    
C
        RETURN
      END SUBROUTINE 
C     
      END MODULE 
      

      
   
