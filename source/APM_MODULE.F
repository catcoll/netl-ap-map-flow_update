      MODULE APM_MODULE
C
C     WRITTEN BY: MATTHEW STADELMAN
C     FILE DESCRIPTION: STORES THE NEEDED VARIABLES AND CONSTANTS FOR
C     2-D LOCAL CUBIC LAW MODEL.
C
C     LAST MODIFIED: 2016/10/27
C ----------------------------------------------------------------------
C               ---- VARIABLE DESCRIPTIONS ----
C
C   UNIT CONVERSION VARIABLES
C     PRES_CONV,DIM_CONV,TIME_CONV, ...
C     RATE_CONV,VISC_CONV,RHO_CONV - STORES THE RESPECTIVE UNIT CONVERSION FOR EACH UNIT TYPE
C     UNIT(7),UNIT_IN(7),UNIT_OUT(7) - ARRAYS TO STORE THE RESPECTIVE STRING REPRESENTATION OF A UNIT TYPE
C
C   STATISTICS VARIABLES:
C     PERC_ARR - STORES THE USER INPUT PERCENTILE VALUES TO OUTPUT
C     FLOW_CF - REPRESENTS THE DISCREPANCY BETWEEN CUBIC LAW AND LOCAL CUBIC LAW (Q LCL)/(Q CL)
C     NPCT - THE NUMBER OF PERCENTILES IN THE PERC_ARRY
C     PERCENTILE - BOOLEAN TO OUTPUT PERCENTILES OR NOT DURING RUNTIME
C
C   FRACTURE VARIABLES:
C     FRAC_PR,FRAC_PS - FRACTURE PRESSURE AND PSEDUO-PRESSURE ARRAYS RESPECTIVELY
C     TRX,TRZ - HORIZONTAL AND VERTICAL GRID BLOCK TRANSMISSIBLITY ARRAYS, DEFINED AT LEFT AND TOP FACES OF A GRIDBLOCK RESPECTIVELY.
C     AVG_TRX,AVG_TRZ - SIMPLE AVERAGES OF THE FRACTURE'S HORIZONTAL AND VERTICAL TRANSSMISSIBILTY.
C     AVG_VISC - AVERAGE VISCOSITY OF THE FRACTURE USED IN LIQUID SIMULATIONS
C     RHO - USER SUPPLIED DENSITY OF THE FLUID, ONLY USED TO CALCULATE REYNOLDS NUMBER
C     INLPB,INLPSB - THE INLET FRACTURE PRESSURE AND PSEDUO-PRESSURE
C     INLET - STORES THE INDICIES OF GRIDBLOCKS AT THE INLET FACE
C     OUTLET - STORES THE INDICIES OF GRIDBLOCKS AT THE OUTLET FACE
C     OUTPB,OUTPSB - THE FACTURE'S OUTLET PRESSURE AND PESDUO-PRESSURE
C     OUTRATE - STORES THE FRACTURE OUTLET FLOW RATE, USED TO CALCULATE OUTPSB IF FRACTURE IS FLOW RATE CONTROLLED
C     RATEC,PRESC - BOOLEANS STATING IF THE FRACTURE IS CONTROLLED WITH A FLOW RATE OR PRESSURE BOUNDARY CONDITION
C
C   LCL MODEL VARIABLE DEFAULTS DEFINED IN SUBROUTINE: INITIALIZE_RUN
C
C ---------------------------------------------------------------------
C
      USE STRING_MODULE, ONLY : MAXLEN
      PUBLIC
C
C     UNIT CONVERSION VARIABLES
      ! VARIABLES TO STORE RESPECTIVE CONVERSION FACTORS
      REAL(8),SAVE :: PRES_CONV,DIM_CONV,TIME_CONV,RATE_CONV
      REAL(8),SAVE :: VISC_CONV,RHO_CONV
      ! VARIABLES TO STORE THE STRING REPRESENTATION OF EACH UNIT
      CHARACTER(MAXLEN),SAVE :: UNIT(7),UNIT_IN(7),UNIT_OUT(7)
C
C     STATISTICS VARIABLES
      REAL(8),ALLOCATABLE,SAVE :: PERC_ARR(:,:)
      REAL(8),SAVE :: FLOW_CF
      INTEGER,SAVE :: NPCT
      LOGICAL,SAVE :: PERCENTILE
C
C     FRACTURE VARAIBLES
      REAL(8),ALLOCATABLE,SAVE :: FRAC_PR(:,:)
      REAL(8),ALLOCATABLE,SAVE :: TRX(:,:),TRZ(:,:),Q(:,:)
      REAL(8),SAVE :: AVG_TRX,AVG_TRZ,AVG_VISC
      REAL(8),SAVE :: INLPB,OUTPB,OUTRATE,INJRATE,RHO
      INTEGER, ALLOCATABLE, SAVE :: INLET(:), OUTLET(:)
      INTEGER,SAVE :: NC
      LOGICAL,SAVE :: RATEC,PRESC
      CHARACTER(MAXLEN), SAVE :: OUTLET_SIDE, INLET_SIDE
C
C
      CONTAINS
C
C     SETS UP VECTORS AND ARRAYS FOR THE FRACTURE PROPERTIES
      SUBROUTINE ALLOCATE_FRAC(NX,NZ)
C
        IMPLICIT NONE
        INTEGER :: N, NX, NZ
        N = 5
        !
        ALLOCATE(Q(N,NX*NZ))
        ALLOCATE(TRX(1:NZ,0:NX),TRZ(0:NZ,1:NX))
        ALLOCATE(FRAC_PR(0:NZ+1,0:NX+1))
        ALLOCATE(INLET(MAX(NX, NZ)), OUTLET(MAX(NX, NZ)))
        !
        RETURN
      END SUBROUTINE
C
      SUBROUTINE DEALLOCATE_FRAC
        !
        DEALLOCATE(TRX,TRZ)
        DEALLOCATE(Q,PERC_ARR)
        DEALLOCATE(FRAC_PR)
        !
        RETURN
      END SUBROUTINE
C
      END MODULE
